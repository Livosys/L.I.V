set $cors_origin "";

if ($http_origin ~* "^https://preview--shix-aide\.lovable\.app$") {
    set $cors_origin $http_origin;
}

add_header Access-Control-Allow-Origin "$cors_origin" always;
add_header Access-Control-Allow-Credentials true always;
add_header Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS" always;
add_header Access-Control-Allow-Headers "Authorization, Content-Type, X-User-Id, X-Tenant-Key" always;

if ($request_method = OPTIONS) {
    return 204;
}
